/*! SpatialBB 21-01-2014 */
var SpatialBB=window.SpatialBB||{};(function(i){"use strict";i.MissingPositionError=function(i){this.name="MissingPositionError",this.message=i||"Missing Position"},i.MissingPositionError.prototype=Error(),i.MissingPositionError.prototype.constructor=i.MissingPositionError})(SpatialBB);var SpatialBB=window.SpatialBB||{};(function(i){"use strict";i.MarkerCollection=Backbone.Collection.extend({model:i.MarkerModel,requirePosition:!0,initialize:function(i,r){r=r||{},_.has(r,"requirePosition")&&(this.requirePosition=r.requirePosition),this.layerGroup=new L.LayerGroup,this.on("add",this.modelAdded,this),this.on("remove",this.modelRemoved,this),this.on("reset",this.collectionReset,this)},getLayerGroup:function(){return this.layerGroup},modelAdded:function(i){i.requirePosition=this.requirePosition;var r=i.getMarker();r||(i.createMarker(i.parsePosition()),r=i.getMarker()),this.layerGroup.addLayer(r)},modelRemoved:function(i){var r=i.getMarker();r&&this.layerGroup.removeLayer(r)},collectionReset:function(){this.layerGroup.clearLayers(),this.each(function(i){i.hasMarker()&&this.layerGroup.addLayer(i.getMarker())},this)},getBounds:function(){return L.latLngBounds(_.compact(this.map(function(i){return i.hasMarker()?i.getMarker().getLatLng():undefined})))}})})(SpatialBB);var SpatialBB=window.SpatialBB||{};(function(i){"use strict";i.MarkerModel=Backbone.Model.extend({requirePosition:!0,initialize:function(i,r){r&&r.collection&&(r.requirePosition=r.collection.requirePosition),r=r||{},_.has(r,"initPos")||(r.initPos=!0),_.has(r,"requirePosition")&&(this.requirePosition=r.requirePosition),r.initPos&&this.createMarker(this.parsePosition())},parsePosition:function(){var r=null;if(this.has("position")&&(r={lon:this.get("position").lon||null,lat:this.get("position").lat||null}),!(r&&r.lon&&r.lat||!this.requirePosition))throw new i.MissingPositionError;return r},parse:function(i){return i.position&&this.createMarker(i.position),i},createMarker:function(i){i&&(this.marker=new L.Marker([i.lat,i.lon]))},getMarker:function(){return this.marker},hasMarker:function(){return!!this.marker}})})(SpatialBB);